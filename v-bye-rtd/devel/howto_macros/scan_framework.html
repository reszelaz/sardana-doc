

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Scan Framework &mdash; sardana 2.4.1-alpha documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="sardana 2.4.1-alpha documentation" href="../../index.html"/>
        <link rel="up" title="Writing macros" href="index.html"/>
        <link rel="next" title="Writing controllers" href="../howto_controllers/index.html"/>
        <link rel="prev" title="Writing macros" href="macros_general.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> sardana
          

          
            
            <img src="../../_static/logo.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                2.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference external" href="http://www.sardana-controls.org">Home Page</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/sardana-org/sardana">Project Page</a></li>
<li class="toctree-l1"><a class="reference external" href="http://pypi.python.org/pypi/sardana">Download from PyPI</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../docs.html">Sardana 2.4 Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../users/index.html">User&#8217;s Guide</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Developer&#8217;s Guide</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Writing macros</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="macros_general.html">General macro development</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Scan macro development</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../howto_controllers/index.html">Writing controllers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../howto_recorders.html">Writing recorders</a></li>
<li class="toctree-l3"><a class="reference internal" href="../howto_test/index.html">Sardana Testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/api_sardana.html">API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide_migration.html">Migration guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/examples.html">Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide_coding.html">Development guidelines</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../sep/index.html">Sardana Enhancement Proposals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_versions.html">Docs for other Sardana versions</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">sardana</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../docs.html">Sardana 2.4 Documentation</a> &raquo;</li>
      
          <li><a href="../index.html">Developer&#8217;s Guide</a> &raquo;</li>
      
          <li><a href="index.html">Writing macros</a> &raquo;</li>
      
    <li>Scan Framework</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/devel/howto_macros/scan_framework.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="scan-framework">
<span id="sardana-macros-scanframework"></span><h1>Scan Framework<a class="headerlink" href="#scan-framework" title="Permalink to this headline">¶</a></h1>
<p>In general terms, we call <em>scan</em> to a macro that moves one or more motors and
acquires data along the path of the motor(s). See the
<a class="reference internal" href="../../users/scan.html#sardana-users-scan"><span class="std std-ref">introduction to the concept of scan in Sardana</span></a>.</p>
<p>While a scan macro could be written from scratch, Sardana provides a higher-
level API (the <em>scan framework</em>) that greatly simplifies the development of
scan macros by taking care of the details about synchronization of motors and
of acquisitions.</p>
<p>The scan framework is implemented in the <code class="xref py py-mod docutils literal"><span class="pre">scan</span></code>
module, which provides the <code class="xref py py-class docutils literal"><span class="pre">GScan</span></code> base class
and its specialized derived classes <code class="xref py py-class docutils literal"><span class="pre">SScan</span></code>
and <code class="xref py py-class docutils literal"><span class="pre">CScan</span></code> for step  and continuous scans,
respectively.</p>
<p>Creating a scan macro consists in writing a generic macro (see
<a class="reference internal" href="macros_general.html#sardana-macros-howto"><span class="std std-ref">the generic macro writing instructions</span></a>) in
which an instance of <code class="xref py py-class docutils literal"><span class="pre">GScan</span></code> is created
(typically in the <a class="reference internal" href="../api/api_macro.html#sardana.macroserver.macro.Macro.prepare" title="sardana.macroserver.macro.Macro.prepare"><code class="xref py py-meth docutils literal"><span class="pre">prepare()</span></code></a> method) which is then invoked in the
<a class="reference internal" href="../api/api_macro.html#sardana.macroserver.macro.Macro.run" title="sardana.macroserver.macro.Macro.run"><code class="xref py py-meth docutils literal"><span class="pre">run()</span></code></a> method.</p>
<p>Central to the scan framework is the
<code class="xref py py-meth docutils literal"><span class="pre">generator()</span></code> function, which
must be passed to the GScan constructor. This generator is a function that
allows to construct the path of the scan (see
<code class="xref py py-class docutils literal"><span class="pre">GScan</span></code> for detailed information on the
generator).</p>
<div class="section" id="a-basic-example-on-writing-a-step-scan">
<h2>A basic example on writing a step scan<a class="headerlink" href="#a-basic-example-on-writing-a-step-scan" title="Permalink to this headline">¶</a></h2>
<p>Step scans are built using an instance of the
<code class="xref py py-class docutils literal"><span class="pre">SScan</span></code> class, which requires a step generator
that defines the path for the motion. Since in a step scan the data is acquired
at each step, the generator controls both the motion and the acquisition.</p>
<p>Note that in general, the generator does not need to generate a determinate (or
even finite) number of steps. Also note that it is possible to write generators
that vary their current step based on the acquired values (e.g., changing step
sizes as a function of some counter reading).</p>
<p>The <code class="xref py py-class docutils literal"><span class="pre">ascan_demo</span></code> macro illustrates
the most basic features of a step scan:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ascan_demo</span><span class="p">(</span><span class="n">Macro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a basic reimplementation of the ascan` macro for demonstration</span>
<span class="sd">    purposes of the Generic Scan framework. The &quot;real&quot; implementation of</span>
<span class="sd">    :class:`sardana.macroserver.macros.ascan` derives from</span>
<span class="sd">    :class:`sardana.macroserver.macros.aNscan` and provides some extra features.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">hints</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;scan&#39;</span> <span class="p">:</span> <span class="s1">&#39;ascan_demo&#39;</span><span class="p">}</span> <span class="c1">#this is used to indicate other codes that the macro is a scan</span>
    <span class="n">env</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;ActiveMntGrp&#39;</span><span class="p">,)</span> <span class="c1">#this hints that the macro requires the ActiveMntGrp environment variable to be set</span>

    <span class="n">param_def</span> <span class="o">=</span> <span class="p">[</span>
       <span class="p">[</span><span class="s1">&#39;motor&#39;</span><span class="p">,</span>      <span class="n">Type</span><span class="o">.</span><span class="n">Moveable</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Motor to move&#39;</span><span class="p">],</span>
       <span class="p">[</span><span class="s1">&#39;start_pos&#39;</span><span class="p">,</span>  <span class="n">Type</span><span class="o">.</span><span class="n">Float</span><span class="p">,</span>    <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Scan start position&#39;</span><span class="p">],</span>
       <span class="p">[</span><span class="s1">&#39;final_pos&#39;</span><span class="p">,</span>  <span class="n">Type</span><span class="o">.</span><span class="n">Float</span><span class="p">,</span>    <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Scan final position&#39;</span><span class="p">],</span>
       <span class="p">[</span><span class="s1">&#39;nr_interv&#39;</span><span class="p">,</span>  <span class="n">Type</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span>  <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Number of scan intervals&#39;</span><span class="p">],</span>
       <span class="p">[</span><span class="s1">&#39;integ_time&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">Float</span><span class="p">,</span>    <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Integration time&#39;</span><span class="p">]</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">motor</span><span class="p">,</span> <span class="n">start_pos</span><span class="p">,</span> <span class="n">final_pos</span><span class="p">,</span> <span class="n">nr_interv</span><span class="p">,</span> <span class="n">integ_time</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
        <span class="c1">#parse the user parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">start_pos</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">final_pos</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">integ_time</span> <span class="o">=</span> <span class="n">integ_time</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nr_points</span> <span class="o">=</span> <span class="n">nr_interv</span><span class="o">+</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interv_size</span> <span class="o">=</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">final</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="n">nr_interv</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;ascan_demo&#39;</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;env&#39;</span><span class="p">,{})</span> <span class="c1">#the &quot;env&quot; dictionary may be passed as an option</span>

        <span class="c1">#create an instance of GScan (in this case, of its child, SScan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gScan</span><span class="o">=</span><span class="n">SScan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_generator</span><span class="p">,</span> <span class="n">moveables</span><span class="o">=</span><span class="p">[</span><span class="n">motor</span><span class="p">],</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">step</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">step</span><span class="p">[</span><span class="s2">&quot;integ_time&quot;</span><span class="p">]</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">integ_time</span> <span class="c1">#integ_time is the same for all steps</span>
        <span class="k">for</span> <span class="n">point_no</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nr_points</span><span class="p">):</span>
            <span class="n">step</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="n">point_no</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">interv_size</span> <span class="c1">#note that this is a numpy array</span>
            <span class="n">step</span><span class="p">[</span><span class="s2">&quot;point_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">point_no</span>
            <span class="k">yield</span> <span class="n">step</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gScan</span><span class="o">.</span><span class="n">step_scan</span><span class="p">():</span> <span class="c1">#just go through the steps</span>
            <span class="k">yield</span> <span class="n">step</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gScan</span><span class="o">.</span><span class="n">data</span> <span class="c1">#the GScan provides scan data</span>
</pre></div>
</div>
<p>The <code class="xref py py-class docutils literal"><span class="pre">ascan_demo</span></code> shows only basic
features of the scan framework, but it already shows that writing a step scan
macro is mostly just a matter of writing a generator function.</p>
<p>It also shows that the <code class="xref py py-meth docutils literal"><span class="pre">scan.gscan.GScan.data()</span></code> method can be used to
provide the needed return value of <a class="reference internal" href="../api/api_macro.html#sardana.macroserver.macro.Macro.data" title="sardana.macroserver.macro.Macro.data"><code class="xref py py-meth docutils literal"><span class="pre">data()</span></code></a></p>
</div>
<div class="section" id="a-basic-example-on-writing-a-continuous-scan">
<h2>A basic example on writing a continuous scan<a class="headerlink" href="#a-basic-example-on-writing-a-continuous-scan" title="Permalink to this headline">¶</a></h2>
<p>Continuous scans are built using an instance of the
<code class="xref py py-class docutils literal"><span class="pre">CScan</span></code> class. Since in the continuous scans
the acquisition and motion are decoupled, CScan requires two independent
generators:</p>
<ul class="simple">
<li>a <em>waypoint generator</em>: which defines the path for the motion in a very
similar way as the step generator does for a step scan. The steps
generated by this generator are also called &#8220;waypoints&#8221;.</li>
<li>a <em>period generator</em> which controls the data acquisition steps.</li>
</ul>
<p>Essentially, <code class="xref py py-class docutils literal"><span class="pre">CScan</span></code> implements the continuous
scan as an acquisition loop (controlled by the period generator) nested within
a motion loop (controlled by the waypoint generator). Note that each loop is
run on an independent thread, and only limited communication occurs between the
two (basically the acquisition starts at the beginning of each movement and
ends when a waypoint is reached).</p>
<p>The <code class="xref py py-class docutils literal"><span class="pre">ascanc_demo</span></code> macro illustrates
the most basic features of a continuous scan::</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ascanc_demo</span><span class="p">(</span><span class="n">Macro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a basic reimplementation of the ascanc` macro for demonstration</span>
<span class="sd">    purposes of the Generic Scan framework. The &quot;real&quot; implementation of</span>
<span class="sd">    :class:`sardana.macroserver.macros.ascanc` derives from</span>
<span class="sd">    :class:`sardana.macroserver.macros.aNscan` and provides some extra features.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">hints</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;scan&#39;</span> <span class="p">:</span> <span class="s1">&#39;ascanc_demo&#39;</span><span class="p">}</span> <span class="c1">#this is used to indicate other codes that the macro is a scan</span>
    <span class="n">env</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;ActiveMntGrp&#39;</span><span class="p">,)</span> <span class="c1">#this hints that the macro requires the ActiveMntGrp environment variable to be set</span>

    <span class="n">param_def</span> <span class="o">=</span> <span class="p">[</span>
       <span class="p">[</span><span class="s1">&#39;motor&#39;</span><span class="p">,</span>      <span class="n">Type</span><span class="o">.</span><span class="n">Moveable</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Motor to move&#39;</span><span class="p">],</span>
       <span class="p">[</span><span class="s1">&#39;start_pos&#39;</span><span class="p">,</span>  <span class="n">Type</span><span class="o">.</span><span class="n">Float</span><span class="p">,</span>    <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Scan start position&#39;</span><span class="p">],</span>
       <span class="p">[</span><span class="s1">&#39;final_pos&#39;</span><span class="p">,</span>  <span class="n">Type</span><span class="o">.</span><span class="n">Float</span><span class="p">,</span>    <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Scan final position&#39;</span><span class="p">],</span>
       <span class="p">[</span><span class="s1">&#39;integ_time&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">Float</span><span class="p">,</span>    <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Integration time&#39;</span><span class="p">]</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">motor</span><span class="p">,</span> <span class="n">start_pos</span><span class="p">,</span> <span class="n">final_pos</span><span class="p">,</span> <span class="n">integ_time</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;ascanc_demo&#39;</span>
        <span class="c1">#parse the user parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">start_pos</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">final_pos</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">integ_time</span> <span class="o">=</span> <span class="n">integ_time</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;env&#39;</span><span class="p">,{})</span> <span class="c1">#the &quot;env&quot; dictionary may be passed as an option</span>

        <span class="c1">#create an instance of GScan (in this case, of its child, CScan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gScan</span> <span class="o">=</span> <span class="n">CScan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">waypointGenerator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_generator</span><span class="p">,</span>
                            <span class="n">periodGenerator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_period_generator</span><span class="p">,</span>
                            <span class="n">moveables</span><span class="o">=</span><span class="p">[</span><span class="n">motor</span><span class="p">],</span>
                            <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_waypoint_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#a very simple waypoint generator! only start and stop points!</span>
        <span class="k">yield</span> <span class="p">{</span><span class="s2">&quot;positions&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="s2">&quot;waypoint_id&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="k">yield</span> <span class="p">{</span><span class="s2">&quot;positions&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">final</span><span class="p">,</span> <span class="s2">&quot;waypoint_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>


    <span class="k">def</span> <span class="nf">_period_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">step</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">step</span><span class="p">[</span><span class="s2">&quot;integ_time&quot;</span><span class="p">]</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">integ_time</span>
        <span class="n">point_no</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span> <span class="c1">#infinite generator. The acquisition loop is started/stopped at begin and end of each waypoint</span>
            <span class="n">point_no</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">step</span><span class="p">[</span><span class="s2">&quot;point_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">point_no</span>
            <span class="k">yield</span> <span class="n">step</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gScan</span><span class="o">.</span><span class="n">step_scan</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">step</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">for another example of a continuous scan implementation
(with more elaborated waypoint generator), see the code of
<a class="reference internal" href="../api/sardana/macroserver/macros.html#sardana.macroserver.macros.scan.meshc" title="sardana.macroserver.macros.scan.meshc"><code class="xref py py-class docutils literal"><span class="pre">meshc</span></code></a></p>
</div>
</div>
<div class="section" id="hooks-support-in-scans">
<h2>Hooks support in scans<a class="headerlink" href="#hooks-support-in-scans" title="Permalink to this headline">¶</a></h2>
<p>In general, the Hooks API provided by the
<code class="xref py py-class docutils literal"><span class="pre">Hookable</span></code> base class allows a macro to run
other code (the hook callable) at certain points of its execution. The hooks
use a &#8220;hints&#8221; mechanism to pass the receiving macro some extra information on
how/when they should be executed. The hints are strings, and its content is not
fixed by the API, being up to each macro to identify, use and/or ignore them.</p>
<p>You can find some examples of the use of hooks in the
<code class="xref py py-mod docutils literal"><span class="pre">hooks</span></code> module.</p>
<p>In the case of the scan macros, the hooks can be either registered directly via
the Hooks API or passed as key:values of the &#8220;step&#8221; dictionary returned by the
scan <code class="xref py py-meth docutils literal"><span class="pre">generator()</span></code> (see
<code class="xref py py-class docutils literal"><span class="pre">GScan</span></code> for more details).</p>
<p>The hints for a given hook are used by the scan framework to select the moment
of the scan execution that the given hook is run. The following is a list of
hint strings that scan macros support (other hints are ignored):</p>
<ul class="simple">
<li>&#8216;pre-scan-hooks&#8217; : before starting the scan.</li>
<li>&#8216;pre-move-hooks&#8217; : for steps: before starting to move.</li>
<li>&#8216;post-move-hooks&#8217;: for steps: after finishing the move.</li>
<li>&#8216;pre-acq-hooks&#8217;  : for steps: before starting to acquire.</li>
<li>&#8216;post-acq-hooks&#8217; : for steps: after finishing acquisition but before
recording the step.</li>
<li>&#8216;post-step-hooks&#8217; : for steps: after finishing recording the step.</li>
<li>&#8216;post-scan-hooks&#8217; : after finishing the scan</li>
</ul>
<p>See the code of <code class="xref py py-class docutils literal"><span class="pre">hooked_scan</span></code>
for a macro that demonstrates the use of the hook points of a scan.</p>
<p>Other examples of the <code class="xref py py-mod docutils literal"><span class="pre">hooks</span></code> module
can be illustrative.</p>
<p>Also, note that the Taurus MacroExecutor widget allows the user to dynamically
add hooks to existing macros before execution.</p>
</div>
<div class="section" id="more-examples">
<h2>More examples<a class="headerlink" href="#more-examples" title="Permalink to this headline">¶</a></h2>
<p>Other macros in the <code class="xref py py-mod docutils literal"><span class="pre">examples</span></code> module
illustrate more features of the scan framework.</p>
<p>See also the code of the standard scan macros in the
<code class="xref py py-mod docutils literal"><span class="pre">scan</span></code> module.</p>
<p>Finally, the documentation and code of <code class="xref py py-class docutils literal"><span class="pre">GScan</span></code>,
<code class="xref py py-class docutils literal"><span class="pre">SScan</span></code> and
<code class="xref py py-class docutils literal"><span class="pre">CScan</span></code> may be helpful.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../howto_controllers/index.html" class="btn btn-neutral float-right" title="Writing controllers" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="macros_general.html" class="btn btn-neutral" title="Writing macros" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Except where otherwise noted, content on this site is
licensed under a Creative Commons Attribution 3.0 License.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'2.4.1-alpha',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>